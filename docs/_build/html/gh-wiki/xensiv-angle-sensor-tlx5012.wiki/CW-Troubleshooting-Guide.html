<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Troubleshooting for C++ Builds &mdash; XENSIV TLx5012B Angle Sensor 2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=6fefd858"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/js/versionwarning.js?v=d4224a34"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            XENSIV TLx5012B Angle Sensor
              <img src="../../_static/ifx_logo_white_green_s.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Troubleshooting for C++ Builds</a><ul>
<li><a class="reference internal" href="#issue-with-c-include-guards">Issue with C++ Include Guards</a><ul>
<li><a class="reference internal" href="#quick-workaround">Quick Workaround</a></li>
<li><a class="reference internal" href="#known-files-requiring-closing">Known Files Requiring Closing <strong>“<em>}</em>”</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#mqtt-module-reserved-c-keywords">MQTT Module Reserved C++ Keywords</a></li>
<li><a class="reference internal" href="#changes-for-the-spi-interface">Changes for the SPI interface</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">XENSIV TLx5012B Angle Sensor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Troubleshooting for C++ Builds</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/gh-wiki/xensiv-angle-sensor-tlx5012.wiki/CW-Troubleshooting-Guide.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="troubleshooting-for-c-builds">
<h1>Troubleshooting for C++ Builds<a class="headerlink" href="#troubleshooting-for-c-builds" title="Link to this heading"></a></h1>
<p>The following changes are requires for an error free build when using the <em>TLE5012B</em> library.
Other errors might appear as different SDK components and sources are included. These are only the one experienced during the integration of the framework library setup.</p>
<section id="issue-with-c-include-guards">
<h2>Issue with C++ Include Guards<a class="headerlink" href="#issue-with-c-include-guards" title="Link to this heading"></a></h2>
<p>The WICED Studio (version 6.4.0) toolchain support C and C++ language. The <em>TLE5012B</em> library is written in C++.</p>
<p>Nevertheless, some of the guards braces to include C in C++ such</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef _cplusplus </span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>are not closed, leading to compilation error.</p>
<section id="quick-workaround">
<h3>Quick Workaround<a class="headerlink" href="#quick-workaround" title="Link to this heading"></a></h3>
<p>As a quick a workaround, in the main program entry point after the <em><strong>application_start( ){}</strong></em> block add an additional <strong>“<em>}</em>”</strong> closing brace.</p>
<p>In the provided <em>app</em> examples file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>

<span class="kt">void</span><span class="w"> </span><span class="n">application_start</span><span class="p">(</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">wiced_result_t</span><span class="w">      </span><span class="n">result</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Initialize the device */</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wiced_init</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">WICED_SUCCESS</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="p">...</span><span class="w"> </span><span class="c1">//Main application</span>
<span class="p">}</span>

<span class="c1">//} /**&lt; Insert and uncomment for WICED missing _cplusplus guards workaround */</span>
</pre></div>
</div>
<p>Even confusing and not elegant it will do the work.</p>
</section>
<section id="known-files-requiring-closing">
<h3>Known Files Requiring Closing <strong>“<em>}</em>”</strong><a class="headerlink" href="#known-files-requiring-closing" title="Link to this heading"></a></h3>
<p>The proper long term solution is to fix those files with unclosed blocks. The following files (in version 6.4.0) have been found with this issue:</p>
<ul class="simple">
<li><p><em>apps/snip/bluetooth/simple_ble_peripheral/ble_event_map.h</em></p></li>
<li><p><em>apps/snip/bluetooth/simple_ble_peripheral/simple_ble_peri.h</em></p></li>
<li><p><em>WICED/platform/ARM_CR4/platform_checkpoint.h</em></p></li>
<li><p><em>WICED/platform/security/BESL/mbedtls_open/include/mbedtls/md5_alt.h</em></p></li>
</ul>
<p>Add the following to the bottom of the file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span><span class="w"> </span><span class="cm">/* extern &quot;C&quot; */</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</section>
</section>
<section id="mqtt-module-reserved-c-keywords">
<h2>MQTT Module Reserved C++ Keywords<a class="headerlink" href="#mqtt-module-reserved-c-keywords" title="Link to this heading"></a></h2>
<p>When including the MQTT module additional compilation errors appear. The keyword <code class="docutils literal notranslate"><span class="pre">new</span></code> is reserved in C++.
In the file <em>libraries/protocols/MQTT/mqtt_linked_list.h</em> substitute it for a non-reserved one, as i.e. <code class="docutils literal notranslate"><span class="pre">newe</span></code>.
Also <code class="docutils literal notranslate"><span class="pre">NULL</span></code> needs to be rewritten as <code class="docutils literal notranslate"><span class="pre">(void</span> <span class="pre">*)</span> <span class="pre">0</span></code>. Check the modifications here:</p>
<img src="img/mqtt-file-changes1.png" width="700px">
<img src="img/mqtt-file-changes2.png" width="700px">
<img src="img/mqtt-file-changes3.png" width="700px">
</section>
<section id="changes-for-the-spi-interface">
<h2>Changes for the SPI interface<a class="headerlink" href="#changes-for-the-spi-interface" title="Link to this heading"></a></h2>
<p>The default pin setting for the first SPI port is on the WICED Header J6 and not on the Arduino Header J12.
This will not work with an Arduino compatible shield attached, so we have to change the pin layout for
not only the chip select (SS) pin, but also for the miso (MISO), mosi (MOSI) and system clock pin (SCK).
(see picture 1.a. the target SPI pin, 1.b. the default set SPI pins)</p>
<p>Default setting for SPI port WICED_SPI_1. This does not work for Arduino shields!.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">MOSI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_21</span>
<span class="w">    </span><span class="n">MISO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_19</span>
<span class="w">    </span><span class="n">SCK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_20</span>
<span class="w">    </span><span class="n">SS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_22</span>
</pre></div>
</div>
<p>Pin setting which works for Arduino shields.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">MOSI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_6</span>
<span class="w">    </span><span class="n">MISO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_8</span>
<span class="w">    </span><span class="n">SCK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_5</span>
<span class="w">    </span><span class="n">SS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_7</span>
</pre></div>
</div>
<p>The <em>TLE5012B</em> needs a continuous low signal on chipselect (SS) during send and receive part, which will not work with the
SPI driver default setting. Also we are using the 3wire SPI, which means that we will change the MISO/MOSI input/output direction between
the sending command and the receiving result.Therefore we set the chipselect (SS) pin on WICED_GPIO_NONE and the real chipselect on WICED_GPIO_7
in the framework SPIC class. Also the default GSIO SPI driver is not complete. We will exchange that with the bit banging driver too.
So a pin setting which works for the TLE5012B shield looks like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">MOSI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_6</span>
<span class="w">    </span><span class="n">MISO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_8</span>
<span class="w">    </span><span class="n">SCK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_5</span>
<span class="w">    </span><span class="n">SS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WICED_GPIO_NONE</span>
</pre></div>
</div>
<p>For these changes in the SPI we add an additional SPI port to the platform_spi_peripherals list as WICED_SPI_0 with the
following setting in the *&lt;WICED_SDK&gt;/platforms/&lt;platform_name&gt;/platform.c file. This additional setting will not disturb
any existing code, as we define a new SPI port.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="n">platform_spi_t</span><span class="w"> </span><span class="n">platform_spi_peripherals</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="n">WICED_SPI_0</span><span class="p">]</span><span class="w">  </span><span class="o">=</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">       </span><span class="p">.</span><span class="n">port</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="n">BCM4390X_SPI_0</span><span class="p">,</span>
<span class="w">       </span><span class="p">.</span><span class="n">pin_mosi</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">platform_gpio_pins</span><span class="p">[</span><span class="n">WICED_GPIO_6</span><span class="p">],</span>
<span class="w">       </span><span class="p">.</span><span class="n">pin_miso</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">platform_gpio_pins</span><span class="p">[</span><span class="n">WICED_GPIO_8</span><span class="p">],</span>
<span class="w">       </span><span class="p">.</span><span class="n">pin_clock</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">platform_gpio_pins</span><span class="p">[</span><span class="n">WICED_GPIO_5</span><span class="p">],</span>
<span class="w">       </span><span class="p">.</span><span class="n">pin_cs</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">platform_gpio_pins</span><span class="p">[</span><span class="n">WICED_GPIO_NONE</span><span class="p">],</span>
<span class="w">       </span><span class="p">.</span><span class="n">driver</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">spi_bb_driver</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
</pre></div>
</div>
<p>Additional to the platform_spi_peripherals setting we need to extend the wiced_spi_t enum in *&lt;WICED_SDK&gt;/platforms/&lt;platform_name&gt;/platform.h
to this, by including the WICED_SPI_0 into it (see picture below).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">WICED_SPI_0</span><span class="p">,</span>
<span class="w">    </span><span class="n">WICED_SPI_1</span><span class="p">,</span>
<span class="w">    </span><span class="n">WICED_SPI_2</span><span class="p">,</span>
<span class="w">    </span><span class="n">WICED_SPI_MAX</span><span class="p">,</span><span class="w"> </span><span class="cm">/* Denotes the total number of SPI port aliases. Not a valid SPI alias */</span>
<span class="p">}</span><span class="w"> </span><span class="n">wiced_spi_t</span><span class="p">;</span>
</pre></div>
</div>
<p>Files to be change:</p>
<ul class="simple">
<li><p>*&lt;WICED_SDK&gt;/platforms/&lt;platform_name&gt;/platform.h</p></li>
<li><p>*&lt;WICED_SDK&gt;/platforms/&lt;platform_name&gt;/platform.c</p></li>
</ul>
<img src="img/CYW943907AEVAL1F-eval-kit.jpg" width="700px">
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Infineon Technologies AG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #0A8276;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #0A8276;
    }

    /* span.caption-text {
      color: white;
    } */

    .wy-menu-vertical header, .wy-menu-vertical p.caption {
    color: white;
    height: 32px;
    display: inline-block;
    line-height: 32px;
    padding: 0 1.618em;
    margin: 12px 0 0 0;
    display: block;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 85%;
    white-space: nowrap;
    }

    /*
    .wy-side-nav-search>a, .wy-side-nav-search .wy-dropdown>a {
    color: #3a7ca8;
    font-size: 100%;
    font-weight: bold;
    display: inline-block;
    padding: 4px 6px;
    margin-bottom: .809em;
    }
    */
    
    .wy-menu-vertical header, .wy-menu-vertical p.caption {
    color: white;
    height: 32px;
    display: inline-block;
    line-height: 32px;
    padding: 0 1.618em;
    margin: 12px 0 0 0;
    display: block;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 85%;
    white-space: nowrap;
    }

    .rst-versions {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 300px;
    color: #fcfcfc;
    background: #6CB4AD;
    font-family: "Lato","proxima-nova", "Helvetica Neue", Arial,sans-serif;
    z-index: 400;
    justify-content: stretch;
    }

  </style>


</body>
</html>